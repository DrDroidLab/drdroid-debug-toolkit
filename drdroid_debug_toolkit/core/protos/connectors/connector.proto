syntax = "proto3";
import "google/protobuf/wrappers.proto";
import "core/protos/base.proto";
import "core/protos/ui_definition.proto";
import "google/protobuf/struct.proto";
import "core/protos/alert_metadata_details.proto";

package core.protos.connectors;

message ConnectorContextMemory {
  google.protobuf.UInt64Value id = 1;
  google.protobuf.StringValue comment = 2;
  google.protobuf.StringValue created_by = 3;
  sfixed64 created_at = 4;
}

message ConnectorFormConfig {
  google.protobuf.StringValue description = 1;
  repeated FormField form_fields = 2;
  google.protobuf.StringValue name = 3;
  google.protobuf.StringValue prerequisites = 4;
}

message PlaybookConnector {
  google.protobuf.UInt64Value playbook_id = 1;
  google.protobuf.StringValue playbook_name = 2;
}

message PeriodicRunStatus {
  enum StatusType {
    UNKNOWN = 0;
    STARTED = 1;
    FINISHED = 2;
    ERROR = 3;
  }
}


message ProxyAgentConnectorMetadata {
  google.protobuf.UInt64Value proxy_agent_connector_id = 1;
  google.protobuf.BoolValue is_alive = 2;
  google.protobuf.BoolValue is_backup = 3;
  google.protobuf.UInt64Value primary_proxy_agent_connector_id = 4;
}

message SlackConnectorMetadata {
  google.protobuf.StringValue workspace_id = 1;
  google.protobuf.StringValue workspace_name = 2;
  google.protobuf.StringValue authed_user_id = 3;
  google.protobuf.StringValue bot_auth_token = 4;
  google.protobuf.StringValue bot_user_id = 5;
  google.protobuf.BoolValue is_debugger_mode_only = 6;
}

message AsanaConnectorMetadata {
  google.protobuf.StringValue access_token = 1;
}

message ProxyAgentMetadata {
  google.protobuf.BoolValue is_alive = 1;
  sfixed64 last_ping_at = 2;
  google.protobuf.BoolValue is_backup = 3;
  google.protobuf.UInt64Value primary_proxy_agent_id = 4;
}

message Connector {
  google.protobuf.UInt64Value id = 1;
  google.protobuf.UInt64Value account_id = 2;
  Source type = 3;
  google.protobuf.BoolValue is_active = 4;
  google.protobuf.StringValue name = 5;
  google.protobuf.StringValue created_by = 6;
  sfixed64 created_at = 7;
  sfixed64 updated_at = 8;
  google.protobuf.StringValue display_name = 9;
  google.protobuf.StringValue category = 10;
  repeated ConnectorKey keys = 11;
  google.protobuf.BoolValue is_proxy_enabled = 12;
  repeated ConnectorContextMemory context_memory = 13;
  google.protobuf.BoolValue is_agent_task_enabled = 14;
  repeated string tags = 15;
  google.protobuf.BoolValue user_enabled = 16;
  repeated ConnectorFormConfig form_configs = 17;
  repeated PlaybookConnector connected_playbooks = 18;
  google.protobuf.StringValue notes = 19;
  google.protobuf.Struct additional_state = 20;

  oneof metadata {
    ProxyAgentConnectorMetadata proxy_agent_connector_metadata = 101;
    SlackConnectorMetadata slack_connector_metadata = 102;
    AsanaConnectorMetadata asana_connector_metadata = 103;
    ProxyAgentMetadata proxy_agent_metadata = 104;
  }
}

message UpdateConnectorOp {
  enum Op {
    UNKNOWN = 0;
    UPDATE_CONNECTOR_NAME = 1;
    UPDATE_CONNECTOR_STATUS = 2;
    UPDATE_CONNECTOR_KEYS = 3;
    UPDATE_CONNECTOR_TAGS = 4;
    UPDATE_BASIC_DETAILS = 5;
    UPDATE_DEFAULT_DESTINATION = 6;
  }

  message UpdateConnectorName {
    google.protobuf.StringValue name = 1;
  }

  message UpdateConnectorStatus {
    google.protobuf.BoolValue is_active = 1;
  }

  message UpdateConnectorKeys {
    repeated ConnectorKey connector_keys = 1;
  }

  message UpdateConnectorTags {
    repeated string tags = 1;
  }

  message UpdateBasicDetails {
    google.protobuf.StringValue display_name = 1;
    repeated string tags = 2;
    google.protobuf.StringValue notes = 3;
    google.protobuf.Struct additional_state = 4;
  }

  message UpdateDefaultDestination {
    google.protobuf.StringValue default_destination = 1;
  }

  Op op = 1;
  oneof update {
    UpdateConnectorName update_connector_name = 2;
    UpdateConnectorStatus update_connector_status = 3;
    UpdateConnectorKeys update_connector_keys = 4;
    UpdateConnectorTags update_connector_tags = 5;
    UpdateBasicDetails update_basic_details = 6;
    UpdateDefaultDestination update_default_destination = 7;
  }
}

enum ReportType {
  UNKNOWN_RT = 0;
  INITIAL = 1;
  FINAL = 2;
}


message ConnectorKey {
  google.protobuf.UInt64Value id = 1;
  SourceKeyType key_type = 2;
  google.protobuf.StringValue key = 3;
  google.protobuf.BoolValue is_active = 4;
  google.protobuf.UInt64Value connector_id = 5;
  sfixed64 created_at = 6;
  sfixed64 updated_at = 7;
  google.protobuf.StringValue display_name = 8;
  google.protobuf.StringValue connector_name = 9;
}
